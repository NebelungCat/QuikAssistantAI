# Торговый ассистент для QUIK

## Общее описание

Торговый ассистент для QUIK - это система автоматической торговли, интегрированная с торговой платформой QUIK. Система анализирует рыночные данные и автоматически отправляет заявки на покупку и продажу ценных бумаг на основе данных из текстовых файлов формата CSV.

## Архитектура системы

### Основные компоненты

1. **trading_assistant.lua** - основной файл системы, содержащий логику обработки заявок
2. **broker_config.lua** - конфигурационный файл с параметрами брокеров
3. **bond_handler.lua** - модуль обработки облигаций
4. **error_handler.lua** - модуль обработки ошибок

## Основные возможности

1. Автоматическое выставление заявок в зависимости от времени суток
2. Поддержка нескольких брокеров (Финам, ВТБ, Промсвязьбанк, Россельхозбанк)
3. Работа с различными типами ценных бумаг (акции, облигации, иностранные бумаги)
4. Логирование всех операций
5. Обработка сделок и автоматическое закрытие позиций
6. Проверка корректности заявок перед выставлением
7. Обработка ошибок и повторная отправка заявок при необходимости

## Формат файлов заявок

Файлы заявок должны находиться в директории `/Data` и иметь следующий формат:

- Название бумаги; Операция (B - покупка, S - продажа); Код бумаги; Количество; Цена
- Строки, начинающиеся с "--", считаются комментариями и игнорируются
- В названии файла указывается аббревиатура брокера (FINAM_, PSB_, VTB_, RSHB_), операция заявки (Buy, Sell) и стратегия (_Edge)

Пример:
```
НМТП;B;NMTP;400;02.0
НКХП;B;NKHP;50;200
-- Это комментарий
Черкизово;B;GCHE;100;1000
```

## Поддерживаемые стратегии

1. **Обычная стратегия** - заявки выставляются по указанной цене
2. **Edge стратегия** (файлы с _Edge) - заявки выставляются по минимально возможной цене для покупки или максимальной для продажи

## Проверки перед выставлением заявок

Система выполняет следующие проверки:

- Проверка на существование уже выставленных заявок на тот же инструмент
- Проверка на соответствие минимальной/максимальной цене инструмента
- Проверка на превышение лимитов объема
- Проверка на минимальную доходность
- Проверка на наличие позиции при выставлении заявки на продажу
- Проверка на превышение номинала у облигаций

## Параметры брокеров

Для каждого брокера определены следующие параметры:

- Broker - название брокера
- ClientCode - код клиента
- AccountCode - основной счет
- AccountCodeSpb - счет на СПБ бирже
- FirmId - идентификатор фирмы
- MaxOrderVolume - максимальный объем заявки
- MinOrderVolume - минимальный объем заявки
- MinYield - минимальная допустимая доходность
- MaxBondNominal - максимальный номинал облигаций
- Commission - комиссия брокера
- SupportedClasses - поддерживаемые классы инструментов
- TimeRestrictions - ограничения по времени торговли

## Обработка ошибок

Система обрабатывает следующие типы ошибок:

- Недостаточно средств (уменьшение объема)
- Цена вне лимитов (корректировка цены)
- Объем вне лимитов (уменьшение объема)
- Слишком частые запросы (задержка и повтор)
- Слишком большая заявка (разделение на части)

## Логирование

Система поддерживает логирование с разными уровнями:

- DEBUG - подробная информация для отладки
- INFO - общая информация о работе системы
- ERROR - сообщения об ошибках

## Установка и запуск

Для использования системы:

1. Скопируйте все файлы в рабочую директорию QUIK
2. Настройте параметры брокеров в файле broker_config.lua
3. Поместите файлы заявок в директорию /Data
4. Запустите скрипт trading_assistant.lua в QUIK

## Зависимости

- QUIK версии 6.17.1343 или выше
- QLua API
- Файлы документации: QLUA.chm, info.chm